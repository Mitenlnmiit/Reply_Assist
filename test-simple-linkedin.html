<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple LinkedIn Text Replacement Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f3f2ef;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .test-description {
            color: #666;
            margin-bottom: 15px;
        }
        
        /* LinkedIn-style editor */
        .linkedin-editor {
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
            padding: 12px;
            font-size: 14px;
            line-height: 1.4;
            color: #000;
            outline: none;
            background: white;
        }
        
        .linkedin-editor:focus {
            border-color: #0073b1;
            box-shadow: 0 0 0 2px rgba(0, 115, 177, 0.2);
        }
        
        .test-buttons {
            margin-top: 15px;
        }
        
        .test-btn {
            background: #0073b1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #005885;
        }
        
        .test-btn.secondary {
            background: #6c757d;
        }
        
        .test-btn.secondary:hover {
            background: #545b62;
        }
        
        .instructions {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #0073b1;
        }
        
        .instructions h3 {
            margin: 0 0 10px 0;
            color: #0073b1;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Simple LinkedIn Text Replacement Test</h1>
    
    <div class="instructions">
        <h3>Simple & Reliable Approach</h3>
        <p>This tests the simple approach: simulate exact user actions (Ctrl+A, Backspace, Ctrl+V) that work reliably on LinkedIn.</p>
        <ul>
            <li><strong>Method 1:</strong> Simulate Ctrl+A, Backspace, Ctrl+V with 25ms delays</li>
            <li><strong>Method 2:</strong> Clipboard-based approach with execCommand</li>
            <li><strong>Method 3:</strong> Direct text replacement with proper events</li>
        </ul>
    </div>
    
    <div class="test-container">
        <div class="test-title">LinkedIn Message Editor Simulation</div>
        <div class="test-description">Tests the simple keyboard simulation approach</div>
        
        <div class="linkedin-editor" contenteditable="true" data-placeholder="Write a message...">
            <p>Type your initial message here. This simulates LinkedIn's message editor.</p>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn" onclick="testKeyboardSimulation(this.parentElement.parentElement)">Test Ctrl+A, Backspace, Ctrl+V</button>
            <button class="test-btn" onclick="testClipboardApproach(this.parentElement.parentElement)">Test Clipboard Approach</button>
            <button class="test-btn" onclick="testDirectReplacement(this.parentElement.parentElement)">Test Direct Replacement</button>
            <button class="test-btn secondary" onclick="clearEditor(this.parentElement.parentElement)">Clear</button>
        </div>
        <div class="status" id="status1" style="display: none;"></div>
    </div>
    
    <div class="test-container">
        <div class="test-title">LinkedIn Message Form Simulation</div>
        <div class="test-description">Tests with different LinkedIn editor types</div>
        
        <div class="linkedin-editor" contenteditable="true" data-test-ql-editor-contenteditable="true">
            <p>This simulates LinkedIn's message form with Quill editor attributes.</p>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn" onclick="testAllMethods(this.parentElement.parentElement)">Test All Methods</button>
            <button class="test-btn" onclick="testWithDelay(this.parentElement.parentElement)">Test With 25ms Delay</button>
            <button class="test-btn secondary" onclick="clearEditor(this.parentElement.parentElement)">Clear</button>
        </div>
        <div class="status" id="status2" style="display: none;"></div>
    </div>
    
    <script>
        // Test Keyboard Simulation (Ctrl+A, Backspace, Ctrl+V)
        function testKeyboardSimulation(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            const testText = 'Hello there, let\'s meet sometime. This was inserted using Ctrl+A, Backspace, Ctrl+V simulation.';
            
            try {
                // Focus the element first
                editor.focus();
                
                // Step 1: Ctrl+A (Select All)
                const ctrlAEvent = new KeyboardEvent('keydown', {
                    key: 'a',
                    code: 'KeyA',
                    ctrlKey: true,
                    bubbles: true,
                    cancelable: true
                });
                editor.dispatchEvent(ctrlAEvent);
                
                // Small delay to ensure selection
                setTimeout(() => {
                    // Step 2: Backspace (Delete selected content)
                    const backspaceEvent = new KeyboardEvent('keydown', {
                        key: 'Backspace',
                        code: 'Backspace',
                        bubbles: true,
                        cancelable: true
                    });
                    editor.dispatchEvent(backspaceEvent);
                    
                    // Small delay before paste
                    setTimeout(() => {
                        // Step 3: Set clipboard content and paste
                        setClipboardContent(testText);
                        
                        // Step 4: Ctrl+V (Paste)
                        const ctrlVEvent = new KeyboardEvent('keydown', {
                            key: 'v',
                            code: 'KeyV',
                            ctrlKey: true,
                            bubbles: true,
                            cancelable: true
                        });
                        editor.dispatchEvent(ctrlVEvent);
                        
                        // Also trigger paste event
                        const pasteEvent = new ClipboardEvent('paste', {
                            bubbles: true,
                            cancelable: true,
                            clipboardData: createClipboardData(testText)
                        });
                        editor.dispatchEvent(pasteEvent);
                        
                        showStatus(status, 'Keyboard simulation completed! Text should be properly integrated.', 'success');
                    }, 25); // 25ms delay as requested
                }, 25); // 25ms delay as requested
                
            } catch (e) {
                showStatus(status, 'Keyboard simulation failed: ' + e.message, 'error');
            }
        }
        
        // Test Clipboard Approach
        function testClipboardApproach(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            const testText = 'Clipboard approach test: This uses execCommand and clipboard API.';
            
            try {
                // Focus and select all
                editor.focus();
                document.execCommand('selectAll', false, null);
                
                // Set clipboard content
                setClipboardContent(testText);
                
                // Paste using execCommand
                const success = document.execCommand('paste', false, null);
                
                if (success) {
                    showStatus(status, 'Clipboard approach succeeded!', 'success');
                } else {
                    // Fallback: Use insertText
                    document.execCommand('insertText', false, testText);
                    showStatus(status, 'Clipboard approach completed with fallback!', 'success');
                }
            } catch (e) {
                showStatus(status, 'Clipboard approach failed: ' + e.message, 'error');
            }
        }
        
        // Test Direct Replacement
        function testDirectReplacement(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            const testText = 'Direct replacement test: This uses direct DOM manipulation with proper events.';
            
            try {
                // Focus the element
                editor.focus();
                
                // Clear existing content
                editor.innerHTML = '';
                editor.textContent = testText;
                
                // Trigger comprehensive events
                const events = [
                    new Event('focus', { bubbles: true }),
                    new Event('focusin', { bubbles: true }),
                    new InputEvent('input', { 
                        bubbles: true, 
                        inputType: 'insertReplacementText',
                        data: testText
                    }),
                    new Event('change', { bubbles: true }),
                    new Event('blur', { bubbles: true }),
                    new Event('focusout', { bubbles: true })
                ];
                
                // Dispatch events with small delays
                events.forEach((event, index) => {
                    setTimeout(() => {
                        editor.dispatchEvent(event);
                    }, index * 5);
                });
                
                showStatus(status, 'Direct replacement completed!', 'success');
            } catch (e) {
                showStatus(status, 'Direct replacement failed: ' + e.message, 'error');
            }
        }
        
        // Test All Methods
        function testAllMethods(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            const testText = 'All methods test: This tests multiple approaches in sequence.';
            
            try {
                // Method 1: Keyboard simulation
                editor.focus();
                
                const ctrlAEvent = new KeyboardEvent('keydown', {
                    key: 'a', code: 'KeyA', ctrlKey: true, bubbles: true, cancelable: true
                });
                editor.dispatchEvent(ctrlAEvent);
                
                setTimeout(() => {
                    const backspaceEvent = new KeyboardEvent('keydown', {
                        key: 'Backspace', code: 'Backspace', bubbles: true, cancelable: true
                    });
                    editor.dispatchEvent(backspaceEvent);
                    
                    setTimeout(() => {
                        setClipboardContent(testText);
                        
                        const ctrlVEvent = new KeyboardEvent('keydown', {
                            key: 'v', code: 'KeyV', ctrlKey: true, bubbles: true, cancelable: true
                        });
                        editor.dispatchEvent(ctrlVEvent);
                        
                        const pasteEvent = new ClipboardEvent('paste', {
                            bubbles: true, cancelable: true, clipboardData: createClipboardData(testText)
                        });
                        editor.dispatchEvent(pasteEvent);
                        
                        showStatus(status, 'All methods test completed!', 'success');
                    }, 25);
                }, 25);
                
            } catch (e) {
                showStatus(status, 'All methods test failed: ' + e.message, 'error');
            }
        }
        
        // Test With Delay
        function testWithDelay(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            const testText = 'Delay test: This uses the exact 25ms timing as requested.';
            
            try {
                editor.focus();
                
                // Simulate the exact sequence with proper delays
                const sequence = [
                    () => {
                        const ctrlAEvent = new KeyboardEvent('keydown', {
                            key: 'a', code: 'KeyA', ctrlKey: true, bubbles: true, cancelable: true
                        });
                        editor.dispatchEvent(ctrlAEvent);
                    },
                    () => {
                        const backspaceEvent = new KeyboardEvent('keydown', {
                            key: 'Backspace', code: 'Backspace', bubbles: true, cancelable: true
                        });
                        editor.dispatchEvent(backspaceEvent);
                    },
                    () => {
                        setClipboardContent(testText);
                        const ctrlVEvent = new KeyboardEvent('keydown', {
                            key: 'v', code: 'KeyV', ctrlKey: true, bubbles: true, cancelable: true
                        });
                        editor.dispatchEvent(ctrlVEvent);
                        
                        const pasteEvent = new ClipboardEvent('paste', {
                            bubbles: true, cancelable: true, clipboardData: createClipboardData(testText)
                        });
                        editor.dispatchEvent(pasteEvent);
                        
                        showStatus(status, 'Delay test completed with 25ms timing!', 'success');
                    }
                ];
                
                // Execute sequence with 25ms delays
                sequence.forEach((step, index) => {
                    setTimeout(step, index * 25);
                });
                
            } catch (e) {
                showStatus(status, 'Delay test failed: ' + e.message, 'error');
            }
        }
        
        // Helper functions
        function setClipboardContent(text) {
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).catch(() => {
                        console.log('Clipboard API failed, using fallback');
                    });
                }
            } catch (e) {
                console.log('Clipboard API not available:', e);
            }
        }
        
        function createClipboardData(text) {
            return {
                getData: (type) => {
                    if (type === 'text/plain') return text;
                    if (type === 'text/html') return `<p>${text}</p>`;
                    return '';
                },
                setData: () => {},
                clearData: () => {},
                types: ['text/plain', 'text/html']
            };
        }
        
        function clearEditor(container) {
            const editor = container.querySelector('.linkedin-editor');
            const status = container.querySelector('.status');
            
            editor.innerHTML = '<p><br></p>';
            editor.focus();
            
            if (status) {
                status.style.display = 'none';
            }
        }
        
        function showStatus(statusElement, message, type) {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }
        
        // Add event listeners for keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey && (e.key === 'x' || e.key === 'X')) {
                e.preventDefault();
                console.log('Alt+X detected - would trigger custom instructions');
                alert('Alt+X detected! This would trigger the custom instructions dialog with the simple approach.');
            } else if (e.altKey && (e.key === 'q' || e.key === 'Q')) {
                e.preventDefault();
                console.log('Alt+Q detected - would trigger direct replacement');
                alert('Alt+Q detected! This would trigger direct text replacement using the simple Ctrl+A, Backspace, Ctrl+V approach.');
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Simple LinkedIn Text Replacement Test loaded');
            console.log('This tests the simple approach: Ctrl+A, Backspace, Ctrl+V with 25ms delays');
            console.log('Use Alt+X for custom instructions, Alt+Q for direct replacement');
        });
    </script>
</body>
</html>
